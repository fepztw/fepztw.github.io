/*
 AngularJS v1.3.0-beta.14
 (c) 2010-2014 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(p,h,q){'use strict';function E(a){var d=[];s(d,h.noop).chars(a);return d.join("")}function k(a){var d={};a=a.split(",");var b;for(b=0;b<a.length;b++)d[a[b]]=!0;return d}function F(a,d){function b(a,c,b,g){c=h.lowercase(c);if(t[c])for(;f.last()&&u[f.last()];)e("",f.last());v[c]&&f.last()==c&&e("",c);(g=w[c]||!!g)||f.push(c);var l={};b.replace(G,function(a,c,d,b,e){l[c]=r(d||b||e||"")});d.start&&d.start(c,l,g)}function e(a,c){var b=0,e;if(c=h.lowercase(c))for(b=f.length-1;0<=b&&f[b]!=c;b--);
if(0<=b){for(e=f.length-1;e>=b;e--)d.end&&d.end(f[e]);f.length=b}}var c,g,f=[],l=a;for(f.last=function(){return f[f.length-1]};a;){g=!0;if(f.last()&&x[f.last()])a=a.replace(RegExp("(.*)<\\s*\\/\\s*"+f.last()+"[^>]*>","i"),function(c,a){a=a.replace(H,"$1").replace(I,"$1");d.chars&&d.chars(r(a));return""}),e("",f.last());else{if(0===a.indexOf("\x3c!--"))c=a.indexOf("--",4),0<=c&&a.lastIndexOf("--\x3e",c)===c&&(d.comment&&d.comment(a.substring(4,c)),a=a.substring(c+3),g=!1);else if(y.test(a)){if(c=a.match(y))a=
a.replace(c[0],""),g=!1}else if(J.test(a)){if(c=a.match(z))a=a.substring(c[0].length),c[0].replace(z,e),g=!1}else K.test(a)&&(c=a.match(A))&&(a=a.substring(c[0].length),c[0].replace(A,b),g=!1);g&&(c=a.indexOf("<"),g=0>c?a:a.substring(0,c),a=0>c?"":a.substring(c),d.chars&&d.chars(r(g)))}if(a==l)throw L("badparse",a);l=a}e()}function r(a){if(!a)return"";var d=M.exec(a);a=d[1];var b=d[3];if(d=d[2])n.innerHTML=d.replace(/</g,"&lt;"),d="textContent"in n?n.textContent:n.innerText;return a+d+b}function B(a){return a.replace(/&/g,
"&amp;").replace(N,function(a){var b=a.charCodeAt(0);a=a.charCodeAt(1);return"&#"+(1024*(b-55296)+(a-56320)+65536)+";"}).replace(O,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(a,d){var b=!1,e=h.bind(a,a.push);return{start:function(a,g,f){a=h.lowercase(a);!b&&x[a]&&(b=a);b||!0!==C[a]||(e("<"),e(a),h.forEach(g,function(b,f){var g=h.lowercase(f),k="img"===a&&"src"===g||"background"===g;!0!==P[g]||!0===D[g]&&!d(b,k)||(e(" "),e(f),e('="'),e(B(b)),e('"'))}),
e(f?"/>":">"))},end:function(a){a=h.lowercase(a);b||!0!==C[a]||(e("</"),e(a),e(">"));a==b&&(b=!1)},chars:function(a){b||e(B(a))}}}var L=h.$$minErr("$sanitize"),A=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,z=/^<\s*\/\s*([\w:-]+)[^>]*>/,G=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,K=/^</,J=/^<\s*\//,H=/\x3c!--(.*?)--\x3e/g,y=/<!DOCTYPE([^>]*?)>/i,I=/<!\[CDATA\[(.*?)]]\x3e/g,N=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,O=/([^\#-~| |!])/g,
w=k("area,br,col,hr,img,wbr");p=k("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr");q=k("rp,rt");var v=h.extend({},q,p),t=h.extend({},p,k("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),u=h.extend({},q,k("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),x=k("script,style"),
C=h.extend({},w,t,u,v),D=k("background,cite,href,longdesc,src,usemap"),P=h.extend({},D,k("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),n=document.createElement("pre"),M=/^(\s*)([\s\S]*?)(\s*)$/;h.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=
["$$sanitizeUri",function(a){return function(d){var b=[];F(d,s(b,function(b,c){return!/^unsafe/.test(a(b,c))}));return b.join("")}}]});h.module("ngSanitize").filter("linky",["$sanitize",function(a){var d=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,b=/^mailto:/;return function(e,c){function g(a){a&&m.push(E(a))}function f(a,b){m.push("<a ");h.isDefined(c)&&(m.push('target="'),m.push(c),m.push('" '));m.push('href="');m.push(a);m.push('">');g(b);m.push("</a>")}if(!e)return e;
for(var l,k=e,m=[],n,p;l=k.match(d);)n=l[0],l[2]==l[3]&&(n="mailto:"+n),p=l.index,g(k.substr(0,p)),f(n,l[0].replace(b,"")),k=k.substring(p+l[0].length);g(k);return a(m.join(""))}}])})(window,window.angular);
//# sourceMappingURL=angular-sanitize.min.js.map

!function(a){"use strict";a.module("ga",[]).factory("ga",["$window",function(t){var n=function(){if(a.isArray(arguments[0]))for(var e=0;e<arguments.length;++e)n.apply(this,arguments[e]);else t.ga&&t.ga.apply(this,arguments)};return n}]).run(["$rootScope","$location","ga",function(a,t,n){a.$on("$routeChangeStart",function(){n("set","page",t.url())})}]).directive("ga",["ga",function(a){return{restrict:"A",scope:!1,link:function(t,n,e){var i=e.gaOn||"click",r=e.ga,l=function(){if(r)"'"===r[0]&&(r="["+r+"]"),r=t.$eval(r);else{var i=n.attr("href");i&&"#"===i&&(i="");var l=e.gaCategory?t.$eval(e.gaCategory):i&&"#"!==i[0]?i.match(/\/\//)?"link-out":"link-in":"button",u=e.gaAction?t.$eval(e.gaAction):i?i:"click",g=e.gaLabel?t.$eval(e.gaLabel):(n[0].title||(n[0].tagName.match(/input/i)?n.attr("value"):n.text())).substr(0,64),o=e.gaValue?t.$eval(e.gaValue):null;r=["send","event",l,u,g],null!==o&&r.push(o)}a.apply(null,r)};"init"===i?l():n.bind(i,l)}}}])}(angular);
(function(){var t,e,n,r=[].join;angular.module("app.service",["ngSanitize","ga"]).factory("WindowScroller",["$window","$timeout","$rootScope"].concat(function(t,e,n){var r,i,a,c,o,s;return r=angular.element(t),i={},a=function(){return i.offsetHeight=t.document.body.offsetHeight,i.clientHeight=t.document.body.clientHeight,i.scrollTop=t.document.body.scrollTop,i},c=[],o=!1,s=function(){var t;return n.$apply(function(){var t,e,n,r,a=[];for(t=0,n=(e=c).length;n>t;++t)r=e[t],a.push(r(i));return a}),t=!1},r.on("scroll",function(){var t;return a(),t?void 0:(requestAnimationFrame(s),t=!0)}),{subscribe:function(t){return c.push(t),e(function(){return t(a())}),function(){return c.splice(c.indexOf(t),1)}}}})).service("Spy",t=function(){function t(){this.spies=[],this.current=null}t.displayName="Spy";var e=t.prototype;return e.add=function(t){return this.spies=this.spies.concat(t)},e.remove=function(t){return this.spies.splice(this.spies.indexOf(t),1)},t}()).service("State",e=function(){function t(){function t(t,e){this[t]=e[0]}var e,r,i={}.hasOwnProperty;for(e in r=n["enum"])i.call(r,e)&&t.call(this,e,r[e])}t.displayName="State";var e=t.prototype,n=t;return t["enum"]={titlebar:["title","toolbox"],labels:[!0,!1]},e.$cycle=function(t){var e,r;return e=n["enum"][t].indexOf(this[t]),r=(e+1)%n["enum"][t].length,console.log(e,r),this[t]=n["enum"][t][r]},t}()).service("UserPreference",n=function(){function t(t){var n;e=t.localStorage,this.canSendData()&&(n=e.userId=e.userId||""+Math.random(),ga("set","&uid",n))}t.displayName="UserPreference";var e,n=t.prototype;return e=null,t.$inject=["$window"],n.subscribe=function(t){e.email=t},n.getEmail=function(){return e.email},n.backout=function(){e.isBackedout=!0},n.canSendData=function(){return!e.isBackedout},t}()).factory("HighlightParser",["$interpolate"].concat(function(t){var e,n,i,a,c,o,s,u,l,p;return e='<{{tagName}} comment="{{id}}" comment-placement="top" comment-append-to-body="true">{{content}}</{{tagName}}>',n=/<span class="[^"]+">([^<]+)<\/span>((?:<sup>.+?<\/sup>)+)/gim,i=/#cmnt(\d+)/g,a="#cmnt".length,c=/<span class="[^"]+">/gim,o=/<\/span>/gim,s="xx-span-xx",u=new RegExp(s,"gm"),l=/\s+class="[^"]+"/gim,p=function(p){return p.replace(n,function(n,c,o){var u;return u=o.match(i).map(function(t){return t.slice(a)}),t(e)({id:r.call(u,","),content:c,tagName:s})}).replace(c,"").replace(o,"").replace(l,"").trim().replace(u,"span")},p.COMMENT_TEMPLATE=e,p})).factory("ItemSplitter",function(){var t,e,n;return t=/\[\s*&#20986;&#34389;\s*(?:&#160;)*/gm,e=/]/gim,n=/<span\s*[^>]*><\/span>/gim,function(r){var i;return i=r.search(t),-1===i&&(i=r.length),{content:r.slice(0,i),ref:r.slice(i).replace(t,"").replace(e,"").replace(n,"").trim()}}}).factory("TableParser",["ItemSplitter","HighlightParser","$sanitize"].concat(function(t,e,n){function r(t){return t.replace(o,"").trim()}function i(t){return t.replace(u,"").replace(l,"").trim()}var a,c,o,s,u,l;return a=/<tr[^>]*>(.+?)<\/tr>/gim,c=/<td[^>]*>(.*?)<\/td>/gim,o=/<\/?[^>]*>/gim,s=/<li[^>]*>(.+?)<\/li>/gim,u=/<li[^>]*>/,l=/<\/li>/,function(o){var u,l,p,m,f,h,g,d,v,y,S,b,E,T,N,O,R,x,$,I,P,w;for(u=o.replace(/\n/gm,"").match(a)||[""],l=(null!=(p=u[0].match(c))?p.slice(1):void 0)||[],f=[],h=0,g=l.length;g>h;++h)d=l[h],f.push(r(d));for(m=f,u.shift(),f=[],h=0,g=u.length;g>h;++h){for(y=u[h],l=y.match(c),S=r(l[0]),l.shift(),E=[],T=0,N=l.length;N>T;++T){for(d=l[T],O=d.match(s)||[],x=[],$=0,I=O.length;I>$;++$)P=O[$],w=t(i(P)),w.content=e(n(w.content)),w.ref=e(n(w.ref)),x.push(w);R=x,E.push(R)}b=E,f.push({title:S,positions:b})}return v=f,{positionTitle:m,perspectives:v}}})).factory("TableData",["TableParser","CommentParser","$http","DATA_URL","$q"].concat(function(t,e,n,r,i){var a;return a=i.defer(),n.get(r).success(function(n){var r;r=t(n),r.comments=e(n),a.resolve(r)}),a.promise})).factory("CommentParser",["linky"].concat(function(t){var e,n,r,i,a,c,o,s,u,l,p,m;return e="REF_MISSING",n="REF_CONTROVERSIAL",r="NOTE",i="SECOND",a="OTHER",c=/<div[^>]*><p[^>]*><a[^>]+name="cmnt(\d+)">[^>]+<\/a>(.+?)<\/div>/gim,o=/^\[([^\]]+)\]\s*/,s=/^\+1/,u=/<span class="[^"]+">/gim,l=/<\/span>/gim,p=/\s+class="[^"]+"/gim,m=function(m){function f(){switch(y){case"&#35036;&#20805;&#35498;&#26126;":return r;case"&#20358;&#28304;&#35531;&#27714;":return e;case"&#20358;&#28304;&#29229;&#35696;":return n;default:return a}}var h,g,d,v,y,S,b,E;for(h={};g=c.exec(m);)d=g[1],v=g[2].replace(u,"").replace(l,"").replace(p,"").trim(),y=null!=(S=v.match(o))?S[1]:void 0,b=f(),E=v.replace(o,"").trim(),E.match(s)&&(b=i),E=t("<p>"+E),h[d]={type:b,content:E};return h},m.types={REF_MISSING:e,REF_CONTROVERSIAL:n,NOTE:r,SECOND:i,OTHER:a},m})).factory("linky",function(){var t,e;return t=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)[^\s<>]*[^\s.;,(){}<>]/,e=/^mailto:/,function(n,r){function i(t){return t?o.push(t):void 0}function a(t,e){return o.push("<a "),angular.isDefined(r)&&(o.push('target="'),o.push(r),o.push('" ')),o.push('href="'),o.push(t),o.push('">'),i(e),o.push("</a>")}var c,o,s,u,l;if(!n)return n;for(c=n,o=[];s=c.match(t);)u=s[0],s[2]===s[3]&&(u="mailto:"+u),l=s.index,i(c.substr(0,l)),a(u,s[0].replace(e,"")),c=c.substring(l+s[0].length);return i(c),o.join("")}})}).call(this);
